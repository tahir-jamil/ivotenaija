"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var _ = require("lodash");
var Subject_1 = require("rxjs/internal/Subject");
// import { LocalNotifications } from "nativescript-local-notifications";
var UserDataService = /** @class */ (function () {
    function UserDataService() {
        this.notificationEnable = true;
        this.currentLeadSource = new Subject_1.Subject();
        this.currentLeadUpdated$ = this.currentLeadSource.asObservable();
    }
    UserDataService.prototype.onchangeIndex = function (data) {
        this.currentLeadSource.next(data);
    };
    UserDataService.prototype.addUser = function (user) {
        if (user.complete == false) {
            if (this.findTaskUserData(user.id)) {
                return true;
            }
            else {
                this.uncompleteArray = JSON.parse(localStorage.getItem('InCompleted')) || []; // get array from localstorage
                this.uncompleteArray.push(user);
                localStorage.setItem('InCompleted', JSON.stringify(this.uncompleteArray)); // save updated array back to localstorage
            }
        }
        else {
            this.addAndRemoveUser(user);
        }
    };
    UserDataService.prototype.addAndRemoveUser = function (user) {
        if (this.findTask(user)) {
            var data = JSON.parse(localStorage.getItem('InCompleted')) || []; // get array from localstorage
            var index = _.findIndex(data, function (o) {
                return o.id == user.id;
            });
            ;
            data.splice(index, 1);
            localStorage.removeItem('InCompleted');
            localStorage.setItem('InCompleted', JSON.stringify(data)); // save updated array back to localstorage
        }
        else {
            console.log(" user not existe in uncompeted");
        }
        if (this.findTaskinComplete(user)) {
            return true;
        }
        else {
            this.completeArray = JSON.parse(localStorage.getItem('CompleatedDone')) || []; // get array from localstorage
            this.completeArray.push(user);
            localStorage.removeItem('CompleatedDone');
            localStorage.setItem('CompleatedDone', JSON.stringify(this.completeArray)); // save updated array back to localstorage
        }
    };
    UserDataService.prototype.removeCompleteUser = function (user) {
        if (this.findTaskinComplete(user)) {
            var data = JSON.parse(localStorage.getItem('CompleatedDone')) || []; // get array from localstorage
            var index = _.findIndex(data, function (o) {
                return (o.id == user.id && o.title == user.title) && (o.description == o.description);
            });
            ;
            data.splice(index, 1);
            localStorage.removeItem('CompleatedDone');
            localStorage.setItem('CompleatedDone', JSON.stringify(data)); // save updated array back to localstorage
        }
    };
    UserDataService.prototype.findTask = function (user) {
        this.uncompleteArray = JSON.parse(localStorage.getItem('InCompleted')) || []; // get array from localstorage
        var findItem = _.find(this.uncompleteArray, function (o) {
            return ((o.id === parseInt(user.id)));
        });
        if (findItem) {
            return findItem;
        }
        else {
            return {
                id: 0,
                title: "",
                description: "",
                startDate: Date,
                endDate: new Date(),
                complete: false
            };
        }
    };
    UserDataService.prototype.findTaskUserData = function (id) {
        var data = JSON.parse(localStorage.getItem('InCompleted')) || []; // get array from localstorage
        return _.find(data, function (o) {
            return o.id === parseInt(id);
        });
    };
    UserDataService.prototype.findTaskinComplete = function (user) {
        this.uncompleteArray = JSON.parse(localStorage.getItem('CompleatedDone')) || []; // get array from localstorage
        var findItem = _.find(this.uncompleteArray, function (o) {
            return ((o.id === parseInt(user.id)));
        });
        return findItem;
    };
    UserDataService.prototype.findTaskObj = function (id) {
        var data = JSON.parse(localStorage.getItem('InCompleted')) || []; // get array from localstorage
        var obj = _.filter(data, function (o) {
            return o.id == parseInt(id);
        });
        return obj[0];
    };
    UserDataService.prototype.findTaskObjComplete = function (id) {
        var data = JSON.parse(localStorage.getItem('CompleatedDone')) || []; // get array from localstorage
        var obj = _.filter(data, function (o) {
            return o.id == parseInt(id);
        });
        return obj[0];
    };
    UserDataService.prototype.getCompleteArray = function () {
        return JSON.parse(localStorage.getItem('CompleatedDone')) || []; // get array from localstorage
    };
    UserDataService.prototype.getUnCompleteArray = function () {
        return JSON.parse(localStorage.getItem('InCompleted')) || []; // get array from localstorage
    };
    UserDataService.prototype.getTotalId = function () {
        if (JSON.parse(localStorage.getItem('InCompleted')) == null) {
            return 0;
        }
        else {
            return JSON.parse(localStorage.getItem('InCompleted')).length + 1;
        }
    };
    UserDataService.prototype.localNotification = function (message) {
        // if (this.notificationEnable == true) {
        //   LocalNotifications.requestPermission().then(granted => {
        //     if (granted) {
        //       LocalNotifications.schedule([{
        //         title: message.title,
        //         body: message.body,
        //         // forceShowWhenInForeground: true,
        //         icon: "res://logo"
        //       }]).then(() => {
        //         console.log("local notification working");
        //       }, error => {
        //         console.dir(error);
        //       });
        //     }
        //   });
        // }
    };
    UserDataService = __decorate([
        core_1.Injectable({
            providedIn: 'root'
        }),
        __metadata("design:paramtypes", [])
    ], UserDataService);
    return UserDataService;
}());
exports.UserDataService = UserDataService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXNlckRhdGEuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInVzZXJEYXRhLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBMkM7QUFDM0MsMEJBQTRCO0FBQzVCLGlEQUFnRDtBQUNoRCx5RUFBeUU7QUFNekU7SUFFRTtRQUdBLHVCQUFrQixHQUFHLElBQUksQ0FBQztRQUVsQixzQkFBaUIsR0FBRyxJQUFJLGlCQUFPLEVBQU8sQ0FBQztRQU8vQyx3QkFBbUIsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsWUFBWSxFQUFFLENBQUM7SUFaNUMsQ0FBQztJQU9qQix1Q0FBYSxHQUFiLFVBQWMsSUFBSTtRQUVoQixJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFJRCxpQ0FBTyxHQUFQLFVBQVEsSUFBSTtRQUVWLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQztZQUMzQixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbkMsTUFBTSxDQUFDLElBQUksQ0FBQztZQUNkLENBQUM7WUFDRCxJQUFJLENBQUMsQ0FBQztnQkFDSixJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLDhCQUE4QjtnQkFDNUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ2hDLFlBQVksQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQywwQ0FBMEM7WUFDdkgsQ0FBQztRQUNILENB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RSxNQUFNO1NBQ25CLENBQUM7O09BRVcsZUFBZSxDQXFLM0I7SUFBRCxzQkFBQztDQUFBLEFBcktELElBcUtDO0FBcktZLDBDQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMvaW50ZXJuYWwvU3ViamVjdCc7XG4vLyBpbXBvcnQgeyBMb2NhbE5vdGlmaWNhdGlvbnMgfSBmcm9tIFwibmF0aXZlc2NyaXB0LWxvY2FsLW5vdGlmaWNhdGlvbnNcIjtcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5cbmV4cG9ydCBjbGFzcyBVc2VyRGF0YVNlcnZpY2Uge1xuXG4gIGNvbnN0cnVjdG9yKCkgeyB9XG4gIGNvbXBsZXRlQXJyYXk7XG4gIHVuY29tcGxldGVBcnJheTtcbiAgbm90aWZpY2F0aW9uRW5hYmxlID0gdHJ1ZTtcblxuICBwcml2YXRlIGN1cnJlbnRMZWFkU291cmNlID0gbmV3IFN1YmplY3Q8YW55PigpO1xuXG4gIG9uY2hhbmdlSW5kZXgoZGF0YSkge1xuXG4gICAgdGhpcy5jdXJyZW50TGVhZFNvdXJjZS5uZXh0KGRhdGEpO1xuICB9XG5cbiAgY3VycmVudExlYWRVcGRhdGVkJCA9IHRoaXMuY3VycmVudExlYWRTb3VyY2UuYXNPYnNlcnZhYmxlKCk7XG5cbiAgYWRkVXNlcih1c2VyKSB7XG5cbiAgICBpZiAodXNlci5jb21wbGV0ZSA9PSBmYWxzZSkge1xuICAgICAgaWYgKHRoaXMuZmluZFRhc2tVc2VyRGF0YSh1c2VyLmlkKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLnVuY29tcGxldGVBcnJheSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ0luQ29tcGxldGVkJykpIHx8IFtdOyAvLyBnZXQgYXJyYXkgZnJvbSBsb2NhbHN0b3JhZ2VcbiAgICAgICAgdGhpcy51bmNvbXBsZXRlQXJyYXkucHVzaCh1c2VyKTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ0luQ29tcGxldGVkJywgSlNPTi5zdHJpbmdpZnkodGhpcy51bmNvbXBsZXRlQXJyYXkpKTsgLy8gc2F2ZSB1cGRhdGVkIGFycmF5IGJhY2sgdG8gbG9jYWxzdG9yYWdlXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYWRkQW5kUmVtb3ZlVXNlcih1c2VyKTtcbiAgICB9XG4gIH1cblxuXG4gIGFkZEFuZFJlbW92ZVVzZXIodXNlcikge1xuICAgIGlmICh0aGlzLmZpbmRUYXNrKHVzZXIpKSB7XG4gICAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ0luQ29tcGxldGVkJykpIHx8IFtdOyAvLyBnZXQgYXJyYXkgZnJvbSBsb2NhbHN0b3JhZ2VcbiAgICAgIGxldCBpbmRleCA9IF8uZmluZEluZGV4KGRhdGEsIGZ1bmN0aW9uIChvKSB7XG4gICAgICAgIHJldHVybiBvLmlkID09IHVzZXIuaWQ7XG4gICAgICB9KTs7XG4gICAgICBkYXRhLnNwbGljZShpbmRleCwgMSk7XG4gICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnSW5Db21wbGV0ZWQnKTtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdJbkNvbXBsZXRlZCcsIEpTT04uc3RyaW5naWZ5KGRhdGEpKTsgLy8gc2F2ZSB1cGRhdGVkIGFycmF5IGJhY2sgdG8gbG9jYWxzdG9yYWdlXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coXCIgdXNlciBub3QgZXhpc3RlIGluIHVuY29tcGV0ZWRcIik7XG5cbiAgICB9XG5cbiAgICBpZiAodGhpcy5maW5kVGFza2luQ29tcGxldGUodXNlcikpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuY29tcGxldGVBcnJheSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ0NvbXBsZWF0ZWREb25lJykpIHx8IFtdOyAvLyBnZXQgYXJyYXkgZnJvbSBsb2NhbHN0b3JhZ2VcbiAgICAgIHRoaXMuY29tcGxldGVBcnJheS5wdXNoKHVzZXIpO1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ0NvbXBsZWF0ZWREb25lJyk7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnQ29tcGxlYXRlZERvbmUnLCBKU09OLnN0cmluZ2lmeSh0aGlzLmNvbXBsZXRlQXJyYXkpKTsgLy8gc2F2ZSB1cGRhdGVkIGFycmF5IGJhY2sgdG8gbG9jYWxzdG9yYWdlXG4gICAgfVxuICB9XG5cbiAgcmVtb3ZlQ29tcGxldGVVc2VyKHVzZXIpIHtcbiAgICBpZiAodGhpcy5maW5kVGFza2luQ29tcGxldGUodXNlcikpIHtcbiAgICAgIGxldCBkYXRhID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnQ29tcGxlYXRlZERvbmUnKSkgfHwgW107IC8vIGdldCBhcnJheSBmcm9tIGxvY2Fsc3RvcmFnZVxuICAgICAgbGV0IGluZGV4ID0gXy5maW5kSW5kZXgoZGF0YSwgZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgcmV0dXJuIChvLmlkID09IHVzZXIuaWQgJiYgby50aXRsZSA9PSB1c2VyLnRpdGxlKSAmJiAoby5kZXNjcmlwdGlvbiA9PSBvLmRlc2NyaXB0aW9uKTtcbiAgICAgIH0pOztcbiAgICAgIGRhdGEuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdDb21wbGVhdGVkRG9uZScpO1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ0NvbXBsZWF0ZWREb25lJywgSlNPTi5zdHJpbmdpZnkoZGF0YSkpOyAvLyBzYXZlIHVwZGF0ZWQgYXJyYXkgYmFjayB0byBsb2NhbHN0b3JhZ2VcbiAgICB9XG4gIH1cblxuXG4gIGZpbmRUYXNrKHVzZXIpIHtcbiAgICB0aGlzLnVuY29tcGxldGVBcnJheSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ0luQ29tcGxldGVkJykpIHx8IFtdOyAvLyBnZXQgYXJyYXkgZnJvbSBsb2NhbHN0b3JhZ2VcbiAgICBsZXQgZmluZEl0ZW0gPSBfLmZpbmQodGhpcy51bmNvbXBsZXRlQXJyYXksIGZ1bmN0aW9uIChvKSB7XG4gICAgICByZXR1cm4gKChvLmlkID09PSBwYXJzZUludCh1c2VyLmlkKSkpO1xuICAgIH0pO1xuXG4gICAgaWYgKGZpbmRJdGVtKSB7XG4gICAgICByZXR1cm4gZmluZEl0ZW07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IDAsXG4gICAgICAgIHRpdGxlOiBcIlwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogXCJcIixcbiAgICAgICAgc3RhcnREYXRlOiBEYXRlLFxuICAgICAgICBlbmREYXRlOiBuZXcgRGF0ZSgpLFxuICAgICAgICBjb21wbGV0ZTogZmFsc2VcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgZmluZFRhc2tVc2VyRGF0YShpZCkge1xuICAgIGxldCBkYXRhID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnSW5Db21wbGV0ZWQnKSkgfHwgW107IC8vIGdldCBhcnJheSBmcm9tIGxvY2Fsc3RvcmFnZVxuICAgIHJldHVybiBfLmZpbmQoZGF0YSwgZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiBvLmlkID09PSBwYXJzZUludChpZCk7XG4gICAgfSk7XG4gIH1cblxuXG4gIGZpbmRUYXNraW5Db21wbGV0ZSh1c2VyKSB7XG4gICAgdGhpcy51bmNvbXBsZXRlQXJyYXkgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdDb21wbGVhdGVkRG9uZScpKSB8fCBbXTsgLy8gZ2V0IGFycmF5IGZyb20gbG9jYWxzdG9yYWdlXG4gICAgbGV0IGZpbmRJdGVtID0gXy5maW5kKHRoaXMudW5jb21wbGV0ZUFycmF5LCBmdW5jdGlvbiAobykge1xuICAgICAgcmV0dXJuICgoby5pZCA9PT0gcGFyc2VJbnQodXNlci5pZCkpKTtcbiAgICB9KTtcbiAgICByZXR1cm4gZmluZEl0ZW07XG4gIH1cblxuXG4gIGZpbmRUYXNrT2JqKGlkKSB7XG4gICAgbGV0IGRhdGEgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdJbkNvbXBsZXRlZCcpKSB8fCBbXTsgLy8gZ2V0IGFycmF5IGZyb20gbG9jYWxzdG9yYWdlXG4gICAgbGV0IG9iaiA9IF8uZmlsdGVyKGRhdGEsIGZ1bmN0aW9uIChvKSB7XG4gICAgICByZXR1cm4gby5pZCA9PSBwYXJzZUludChpZCk7XG4gICAgfSk7XG4gICAgcmV0dXJuIG9ialswXTtcbiAgfVxuXG4gIGZpbmRUYXNrT2JqQ29tcGxldGUoaWQpIHtcbiAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ0NvbXBsZWF0ZWREb25lJykpIHx8IFtdOyAvLyBnZXQgYXJyYXkgZnJvbSBsb2NhbHN0b3JhZ2VcbiAgICBsZXQgb2JqID0gXy5maWx0ZXIoZGF0YSwgZnVuY3Rpb24gKG8pIHtcbiAgICAgIHJldHVybiBvLmlkID09IHBhcnNlSW50KGlkKTtcbiAgICB9KTtcbiAgICByZXR1cm4gb2JqWzBdO1xuICB9XG5cblxuICBnZXRDb21wbGV0ZUFycmF5KCkge1xuICAgIHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdDb21wbGVhdGVkRG9uZScpKSB8fCBbXTsgLy8gZ2V0IGFycmF5IGZyb20gbG9jYWxzdG9yYWdlXG4gIH1cblxuICBnZXRVbkNvbXBsZXRlQXJyYXkoKSB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ0luQ29tcGxldGVkJykpIHx8IFtdOyAvLyBnZXQgYXJyYXkgZnJvbSBsb2NhbHN0b3JhZ2VcbiAgfVxuXG4gIGdldFRvdGFsSWQoKSB7XG4gICAgaWYgKEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ0luQ29tcGxldGVkJykpID09IG51bGwpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnSW5Db21wbGV0ZWQnKSkubGVuZ3RoICsgMTtcbiAgICB9XG4gIH1cblxuXG4gIGxvY2FsTm90aWZpY2F0aW9uKG1lc3NhZ2UpIHtcbiAgICAvLyBpZiAodGhpcy5ub3RpZmljYXRpb25FbmFibGUgPT0gdHJ1ZSkge1xuICAgIC8vICAgTG9jYWxOb3RpZmljYXRpb25zLnJlcXVlc3RQZXJtaXNzaW9uKCkudGhlbihncmFudGVkID0+IHtcbiAgICAvLyAgICAgaWYgKGdyYW50ZWQpIHtcbiAgICAvLyAgICAgICBMb2NhbE5vdGlmaWNhdGlvbnMuc2NoZWR1bGUoW3tcbiAgICAvLyAgICAgICAgIHRpdGxlOiBtZXNzYWdlLnRpdGxlLFxuICAgIC8vICAgICAgICAgYm9keTogbWVzc2FnZS5ib2R5LFxuICAgIC8vICAgICAgICAgLy8gZm9yY2VTaG93V2hlbkluRm9yZWdyb3VuZDogdHJ1ZSxcbiAgICAvLyAgICAgICAgIGljb246IFwicmVzOi8vbG9nb1wiXG4gICAgLy8gICAgICAgfV0pLnRoZW4oKCkgPT4ge1xuICAgIC8vICAgICAgICAgY29uc29sZS5sb2coXCJsb2NhbCBub3RpZmljYXRpb24gd29ya2luZ1wiKTtcbiAgICAvLyAgICAgICB9LCBlcnJvciA9PiB7XG4gICAgLy8gICAgICAgICBjb25zb2xlLmRpcihlcnJvcik7XG4gICAgLy8gICAgICAgfSk7XG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH0pO1xuICAgIC8vIH1cblxuICB9XG5cblxufVxuXG4iXX0=